# Практическое задание 35.4

## Задания

### Описание задачи
В предыдущих блоках ты научился создавать функции с параметрами, значениями по умолчанию, а также работать с переменным количеством аргументов (`*args`, `**kwargs`). Теперь важно закрепить понимание **области видимости переменных** — как функции взаимодействуют с переменными извне и какие переменные создаются внутри.

Твоя задача — написать программу, которая моделирует простую систему учета посещений для небольшого клуба. В системе есть глобальный счетчик всех посещений и отдельные списки посещений для каждого участника. Ты будешь работать с **глобальными** и **локальными** переменными, а также использовать **замыкание** для создания персональных счетчиков.

**Контекст:**
- `total_visits` — глобальная переменная, общее количество всех посещений клуба.
- Функция `register_visit(member_name)` должна:
    1. Увеличивать глобальную переменную `total_visits` на 1.
    2. Возвращать **персональную функцию-счетчик** для этого участника. Эта внутренняя функция при каждом вызове должна:
        - Увеличивать свой *локальный* счетчик посещений (созданный в замыкании) на 1.
        - Возвращать текущее количество персональных посещений этого участника.
- Ты также создашь функцию `get_stats()`, которая возвращает словарь со статистикой: общее количество посещений и список всех участников.

**Важно:** Изменение глобальной переменной `total_visits` должно происходить только в момент регистрации нового посещения (вызов `register_visit`), а не при каждом вызове персонального счетчика.

### Пример входных и выходных данных
**Пример 1: Базовый сценарий**
```python
# Инициализация
total_visits = 0

# Код студента (функции register_visit, get_stats и т.д.) будет здесь

# Симуляция работы
visit_counter_anna = register_visit("Анна")
visit_counter_igor = register_visit("Игорь")

print(visit_counter_anna())  # Вызов персонального счетчика Анны
print(visit_counter_anna())
print(visit_counter_igor())  # Вызов персонального счетчика Игоря

print("Общая статистика:", get_stats())
```
**Ожидаемый вывод:**
```
1
2
1
Общая статистика: {'total_visits': 2, 'members': ['Анна', 'Игорь']}
```
**Пояснение:**
- `register_visit("Анна")` увеличивает `total_visits` с 0 до 1 и возвращает персональную функцию для Анны.
- Первые два вызова `visit_counter_anna()` увеличивают *локальный счетчик Анны* с 0 до 1, а затем до 2. Глобальный `total_visits` при этом не меняется.
- `register_visit("Игорь")` увеличивает `total_visits` с 1 до 2.
- Вызов `visit_counter_igor()` возвращает 1 (первое персональное посещение Игоря).
- `get_stats()` возвращает актуальные общие данные.

**Пример 2: Проверка независимости счетчиков**
```python
total_visits = 0

counter1 = register_visit("Ольга")
counter2 = register_visit("Петр")

print(counter1(), counter1(), counter1())  # 1, 2, 3
print(counter2(), counter2())               # 1, 2
print("Всего посещений клуба:", total_visits)  # Должно быть 2
print(get_stats())
```
**Ожидаемый вывод:**
```
1 2 3
1 2
Всего посещений клуба: 2
{'total_visits': 2, 'members': ['Ольга', 'Петр']}
```

### Критерии проверки и ограничения
1.  **Область видимости:** Глобальная переменная `total_visits` должна быть изменена только с использованием ключевого слова `global` внутри функции `register_visit`.
2.  **Замыкание:** Персональный счетчик для каждого участника должен быть реализован как внутренняя функция, которая "запоминает" свое состояние (количество вызовов) через замыкание. Не используй глобальные переменные или атрибуты функций для хранения этих данных.
3.  **Интеграция:** Функция `get_stats()` должна корректно работать с глобальной переменной `total_visits` и вести список всех зарегистрированных участников. Для хранения списка участников можно использовать глобальную переменную (например, `members_list`) или другую подходящую структуру в рамках пройденных тем.
4.  **Запрещенные темы:** Не используй классы, декораторы, модули, которые не были пройдены. Фокус — на области видимости (`global`, локальные переменные, замыкание).
5.  **Чистота функций:** Функция `register_visit` не должна печатать что-либо, она только изменяет состояние и возвращает другую функцию.

### Решение задачи (псевдокод)
1.  Объяви глобальную переменную `total_visits` и инициализируй ее нулем.
2.  Создай глобальный список (например, `all_members`) для хранения имен участников.
3.  Определи функцию `register_visit(member_name)`:
    *   Объяви, что будешь использовать глобальную переменную `total_visits`.
    *   Увеличь `total_visits` на 1.
    *   Добавь `member_name` в глобальный список `all_members`, если этого имени там еще нет.
    *   Создай локальную переменную `personal_count` и инициализируй ее нулем.
    *   Внутри `register_visit` определи внутреннюю функцию (без параметров):
        *   Объяви, что будешь использовать нелокальную переменную `personal_count` (или переменную из внешней области видимости).
        *   Увеличь `personal_count` на 1.
        *   Верни текущее значение `personal_count`.
    *   Верни эту внутреннюю функцию как результат.
4.  Определи функцию `get_stats()`:
    *   Верни словарь с ключами `'total_visits'` (значение глобальной переменной) и `'members'` (копию глобального списка участников).

### Рекомендации
-   **Вынести в отдельную функцию:** Логику проверки и добавления уникального имени участника в список `all_members` можно вынести в небольшую вспомогательную функцию `add_member_if_new(name)`, чтобы основной код `register_visit` был чище.
-   **PEP8:**
    -   Используй `snake_case` для имен переменных и функций (`total_visits`, `register_visit`).
    -   После определения функции оставляй две пустые строки перед следующим объявлением на верхнем уровне.
